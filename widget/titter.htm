<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>


<template id="titter-template">
    <div id="titter-id">
        <form class="margin-bottom" role="form" action="/sendComment">
            <div class="form-group col-xs-12 has-error">
                <textarea rows="3" class="form-control" placeholder="Type text to post on our page" name="comment" id="comment" onkeyup="createImage();"></textarea>
                <div id="result" class="help-block">Max 672 characters</div>
            </div>
            <div class="form-group col-xs-12">
                <div class="pull-right">
                    <div class="pull-right">
                        <label class="comment-limit">672</label>
                        <button type="button" class="btn btn-primary" onclick="saveCanvas();"><span class="glyphicon glyphicon-ok"></span>Send</button>
                    </div>
                </div>
            </div>
        </form>
        <ul class="breadcrumb twitter">
            <li class="active">Comments</li>
            <li class="pull-right"><!--<a href="#" class="lin"><span class="glyphicon glyphicon-flag"></span>Flag</a>--></li>
        </ul>
        <canvas id="twitterPost" width="150" height="150" style="display:none;"></canvas>
        <a class="twitter-timeline" href="https://twitter.com/search?q=webrunes.com" data-widget-id="570802230606176256">Tweets about webrunes.com</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
</template>

<script>
    (function($){
        var importDoc = document.currentScript.ownerDocument;

        var template = importDoc.querySelector('#titter-template');
        var $template = $(template.innerHTML);

        var proto = Object.create(HTMLElement.prototype);
        proto.createdCallback = function() {
            this.outerHTML = $template.get(0).outerHTML;
        };
        document.registerElement('titter-widget', {prototype: proto});
    })(jQuery);
</script>
<script type="text/javascript">
    function createImage() {
        var canvas = document.getElementById('twitterPost');
        if (canvas.getContext) {
            var ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = "18px Arial";
            ctx.fillText(document.getElementById('comment').value, 10, 30);
        }
        //$("#twitterPost").show();
    }

    function saveCanvas() {
        createImage();
        var canvas = document.getElementById('twitterPost');
        var comment = document.getElementById('comment').value;
        var imageData = canvas.toDataURL('image/png');

        //dataType: 'json', removed because of ajax error
        $.ajax({
            url: 'http://54.235.73.25:5001/sendComment',
            type: 'post',
            data: {
                'fileData': imageData,
                'comment': comment
            },


        }).done(function(data) {
            document.getElementById('comment').value = '';
            console.log("successfully sent");
            $('#result').html("Successfully sent!").removeClass("redError");

        }).fail(function(request,error) {
            console.log("Request: " + JSON.stringify(request));
            $('#result').html("Error while executing your request :(").addClass("redError");
        });

    }
</script>
