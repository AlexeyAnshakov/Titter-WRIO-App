<div id="titter-template">

<iframe id="titteriframe" src="http://titter.webrunes.com" width="720" height="2000" frameborder="no" scrolling="no"></iframe>
<script>
    !function (d,elementId) {

        var CommendId = function(){
            var scripts = d.getElementsByTagName("script");
            var jsonData = new Object();
            var jsonArray = [];
            var has = false;
            for(var i=0; i< scripts.length; i++){
                if(scripts[i].type=='application/ld+json') {
                    has = true;
                    jsonData = JSON.parse(scripts[i].innerHTML);
                    jsonArray.push(jsonData);
                }
            }
            var completeJson = jsonArray;
            complete_script=completeJson;

            return getFinalJSON(completeJson);
        };
        var getFinalJSON = function(json,hasPart){
            for(var j=0; j < json.length; j++){
                comment = json[j];

                var commentid = comment['comment'];
                if (commentid) {
                    return commentid;
                }
            };
            return null;
        };


        var el = d.getElementById(elementId);
        el.onload = function () {
            var w= el.contentWindow;
            var data = {
                url:window.location.href
            };
            var id = CommendId();
            if (id) {
                data['commentid'] = id;
            }
            w.postMessage(JSON.stringify(data), "*");
        }
    }(document,"titteriframe");
</script>

</div>
